{% extends 'base.html' %}
{% block title %}Cadastro dos Pets{% endblock %}
{% block content %}

      <!-- Cabeçalho da Página (Título + Pesquisa) -->
      <div class="page-header">
        <h1 class="page-title">Cadastro dos Pets</h1>
        
        <!-- Formulário de Pesquisa -->
        <form method="GET" action="{{ url_for('index') }}" class="search-bar">
          
          <label for="search">Pesquisa:</label>
          
          <input type="text" id="search" name="pesquisa" placeholder="Nome do pet ou dono..." value="{{ query or '' }}">
        </form>
      </div>

      <!-- Botão de Adicionar -->
      <a href="{{ url_for('adicionar') }}" class="btn-custom-verde" style="margin-bottom: 1.5rem; display: inline-block;">Adicionar Novo Cachorro</a>
      
      <!-- Tabela de Pets -->
      <table class="table-custom">
          <thead>
              <tr>
                  <th style="width: 80px;">Foto</th> 
                  <th>Nome</th>
                  <th>Dono</th>
                  <th>Energia</th>
                  <th>Ações</th>
              </tr>
          </thead>
          <tbody>
              <!-- 
                *** MUDANÇA AQUI ***
                Agora fazemos o loop em 'pagination.items' 
              -->
              {% for c in pagination.items %}
              <tr>
                  <td>
                    <img src="{{ url_for('static', filename='uploads/' + (c.foto_perfil or 'default_pet.png')) }}" 
                         alt="Foto de {{ c.nome }}" 
                         class="table-pet-photo">
                  </td>
                  <td>{{ c.nome }}</td>
                  <td>{{ c.proprietario }}</td>
                  <td>
                    {% if c.grau_energia == 'A' %} Alto
                    {% elif c.grau_energia == 'M' %} Médio
                    {% else %} Baixo
                    {% endif %}
                  </td>
                  <td class="action-buttons">
                      <a href="{{ url_for('editar', id=c.id) }}" class="btn-custom-laranja">Editar</a>
                      
                      <form action="{{ url_for('deletar', id=c.id) }}" method="POST" style="display: inline-block;" 
                            onsubmit="return confirm('Tem certeza que deseja deletar o pet {{ c.nome }}?')">
                        <button type="submit" class="btn-custom-vermelho">Deletar</button>
                      </form>
                  </td>
              </tr>
              <!-- 
                *** MUDANÇA AQUI ***
                Agora checamos por 'pagination.items'
              -->
              {% else %}
              <tr class="no-data">
                  <td colspan="5"> 
                    {% if query %}
                      Nenhum pet encontrado para a busca: "{{ query }}"
                    {% else %}
                      Nenhum cachorro cadastrado ainda.
                    {% endif %}
                  </td>
              </tr>
              {% endfor %}
          </tbody>
      </table>

      <!-- 
        *** NOVA SEÇÃO DE PAGINAÇÃO ***
        Aqui adicionamos os links de página
      -->
      <nav class="pagination">
        <!-- Link para Página Anterior (se existir) -->
        {% if pagination.has_prev %}
          <a href="{{ url_for('index', page=pagination.prev_num, pesquisa=query or none) }}">&laquo; Anterior</a>
        {% endif %}

        <!-- Links para as Páginas (ex: 1, ..., 3, 4, 5, ..., 10) -->
        {% for page_num in pagination.iter_pages(left_edge=1, right_edge=1, left_current=2, right_current=2) %}
          {% if page_num %}
            {% if page_num == pagination.page %}
              <!-- Página Atual (fica verde) -->
              <a href="#" class="active">{{ page_num }}</a>
            {% else %}
              <!-- Outras Páginas -->
              <a href="{{ url_for('index', page=page_num, pesquisa=query or none) }}">{{ page_num }}</a>
            {% endif %}
          {% else %}
            <!-- Mostra '...' se houver muitas páginas -->
            <span class="pagination-ellipsis">...</span>
          {% endif %}
        {% endfor %}

        <!-- Link para Próxima Página (se existir) -->
        {% if pagination.has_next %}
          <a href="{{ url_for('index', page=pagination.next_num, pesquisa=query or none) }}">Próximo &raquo;</a>
        {% endif %}
      </nav>

{% endblock %}
